define("block_aiassistant/chat",["exports","core/templates","./request"],(function(_exports,_templates,_request){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0;async function addMessage(text,role,time,chat){const{html:html,js:js}=await(0,_templates.renderForPromise)("block_aiassistant/messages",{role:role,text:text,time:time.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hourCycle:"h24"})});chat.insertAdjacentHTML("beforeend",html),chat.scrollTop=chat.scrollHeight,js&&(0,_templates.runTemplateJS)(js)}_exports.init=instanceid=>{console.log("âš¡ INIT WORK");const parent=document.querySelector(`[class="footer"][data-instance-id="${instanceid}"]`),submitButton=parent.querySelector('[data-action="submit"]'),textarea=parent.querySelector('[data-region="input"]'),chat=document.querySelector(`[data-role="chat"][data-instance-id="${instanceid}"]`);console.log({submitButton:submitButton,textarea:textarea}),submitButton.addEventListener("click",(()=>{if(textarea){const text=textarea.value.trim();if(""!==text){const date=new Date,time=Math.floor(date.getTime()/1e3);addMessage(text,"user",date,chat),textarea.value="";(0,_request.requestForAssistant)(text,time,15).done((function(response){"success"==response.status?(console.log("answer:",response.answer),addMessage(response.answer,"assistant",new Date(1e3*response.answertime),chat)):console.log("error:",response.message)})).fail((function(fail){console.log("error",fail)}))}}else console.error("Textarea not found!")}))}}));

//# sourceMappingURL=chat.min.js.map